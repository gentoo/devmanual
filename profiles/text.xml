<?xml version="1.0"?>
<guide self="profiles/">
<chapter>
<title>Profiles</title>

<body>
<warning>
This section is currently in process of being corrected and split between
profile files and repository metadata. Treat its contents with caution.
</warning>

<p>
This section provides details on the profile directory format. For other files
in the <c>profiles/</c> directory, please see <uri link="::metadata"/>.
</p>
</body>

<section>
<title>make.defaults</title>
<body>

<p>
The <c>make.defaults</c> file in <c>profiles/</c> provides a minimal set of defaults
for the kinds of values which may be set in <c>make.conf</c> (<c>CFLAGS</c>, <c>USE</c>,
<c>FEATURES</c> etc) along with certain control variables (eg <c>USE_EXPAND</c>).
These values can further be refined by additional <c>make.defaults</c> files in
subprofiles.
</p>

<p>
In general, <c>make.defaults</c> should not be modified without consulting the
relevant arch team, or <c>gentoo-dev</c> for high-up <c>make.defaults</c> files.
</p>

</body>
</section>

<section>
<title>package.mask</title>
<body>

<p>
The <c>package.mask</c> file can be used to hard mask packages or
certain versions of packages that should not be merged by users.
This is often used when adding certain experimental (either in ebuild
or upstream terms) packages to the tree, or to prevent merging of
packages that are broken or break something else. Every entry should
have a comment detailing the specific reason for the mask. The format
of the <c>package.mask</c> file is described in <c>man portage</c>.
</p>

<p>
This file can be used in subprofiles to mask packages only for certain setups.
</p>

</body>
</section>

<section>
<title>packages</title>
<body>

<p>
The <c>packages</c> file in <c>profiles/</c> controls the packages pulled in by the
<c>system</c> target. The <c>base/packages</c> file must not be modified without
discussion on the <c>gentoo-dev</c> list; subprofile overrides are up to the
relevant arch teams.
</p>

<p>
Note that <c>packages</c> can be used to require that specific versions of a package
be used, for example <c>&lt;sys-kernel/linux-headers-2.5</c> in a profile requiring
a 2.4 kernel. If this is done with the intention of requiring <b>only</b> a lower version
(that is to say, not a &gt; or &gt;= restriction, and with slots not affecting the
outcome), then the entry in <c>packages</c> must be accompanied by a corresponding
<c>package.mask</c> entry to ensure that no other versions get installed.
</p>

</body>
</section>

<section>
<title>profiles.desc</title>
<body>

<todo>
Find someone who knows exactly what this file's really used for with
current portage versions and what is and isn't allowed.
</todo>

</body>
</section>

<section>
<title>use.mask</title>
<body>

<p>
The <c>use.mask</c> file can be used to mark <c>USE</c> flags as unavailable on a
particular profile. This can be useful for various reasons:
</p>

<ul>
  <li>
    Masking hardware-specific feature flags. For example, <c>mmx</c> and <c>sse</c> are
    only available on x86, <c>altivec</c> is only available on <c>ppc</c> and <c>vis</c> is
    only available on sparc v9.
  </li>
  <li>
    Disabling unavailable soft dependencies. A simple hypothetical example <d /> say
    <c>fooapp</c> works on <c>mips</c>, but has an optional dependency (controlled by
    the <c>bar</c> flag) upon <c>libbar</c>, which doesn't work on <c>mips</c>. Then by
    adding the <c>bar</c> flag to <c>profiles/arch/mips/use.mask</c>,
    <c>fooapp</c> could be made available to <c>mips</c> users with the unresolvable
    dependency forcibly disabled.
  </li>
</ul>

<p>
Note that <c>use.mask</c> is a per-flag thing, not per package's use of a given
flag. This is one of the reasons that USE flags must have a specific well
defined purpose.
</p>

<p>
Updates to <c>use.mask</c> should be handled via the relevant arch team.
</p>

<p>
See <uri link="::general-concepts/use-flags/#noblah USE Flags"/> for more discussion.
</p>

</body>
</section>

</chapter>
</guide>
