<?xml version="1.0"?>
<guide self="ebuild-writing/users-and-groups/">
<chapter>
<title>Users and Groups</title>

<body>
<p>
Creating users and groups is governed by <uri
link="https://gentoo.org/glep/glep-0081.html">GLEP 81</uri>.  It is implemented
via <c>acct-user</c> and <c>acct-group</c> eclasses.
</p>

<p>
New users and groups are created as packages respectively in <c>acct-user</c>
and <c>acct-group</c> categories.  First, choose UIDs/GIDs that are not used by
any other package.  You should consult the <uri
link="https://wiki.gentoo.org/wiki/Project:Quality_Assurance/UID_GID_Assignment">
UID/GID assignment list</uri> maintained by the QA project, and possibly the
UID/GID registries maintained by other distributions that are linked on the
same page.  Afterwards, send the proposed ebuilds to the <c>gentoo-dev</c>
mailing list for review.  The naming conventions for user and group ebuilds are
explained in the following sections. Finally, after getting positive reviews,
commit the new user and group packages.
</p>

<p>
The historical way of using <c>user.eclass</c> directly is now deprecated
and must not be used for new packages.
</p>
</body>

<section>
<title>Group ebuilds</title>
<body>

<p>
Group ebuilds are placed in <c>acct-group</c> category, with the package name
matching the group name.  The following can be used as a template for writing
group ebuilds:
</p>

<pre>
# Copyright 2019 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=7

inherit acct-group

DESCRIPTION="Meaningful description of the group"
ACCT_GROUP_ID=123
</pre>

<p>
<c>ACCT_GROUP_ID</c> must be set to the requested GID.
</p>

</body>
</section>

<section>
<title>User ebuilds</title>
<body>

<p>
User ebuilds are placed in <c>acct-user</c> category, with the package name
matching the user name.  The following can be used as a template for writing
user ebuilds:
</p>

<pre>
# Copyright 2019 Gentoo Authors
# Distributed under the terms of the GNU General Public License v2

EAPI=7

inherit acct-user

DESCRIPTION="Meaningful description of the user"
ACCT_USER_ID=123
ACCT_USER_SHELL=/usr/bin/foo
ACCT_USER_HOME=/var/lib/foo
ACCT_USER_HOME_OWNER=foo:bar
ACCT_USER_HOME_PERMS=0775
ACCT_USER_GROUPS=( foo bar baz )

acct-user_add_deps
</pre>

<p>
<c>ACCT_USER_ID</c> must be set to the requested GID.  <c>ACCT_USER_GROUPS</c>
should list all the groups user belongs to, the primary group first.  All
the other keys are optional.
</p>

<p>
<c>ACCT_USER_SHELL</c> can be used to set the shell for the user.  If unset,
the best system equivalent of nologin is used.  <c>ACCT_USER_HOME</c> specifies
the home directory, with <c>/dev/null</c> being the default.
<c>ACCT_USER_HOME_OWNER</c> can be used to override the ownership of the home
directory, and <c>ACCT_USER_HOME_PERMS</c> to override the default permissions.
The defaults are the user and primary group for the owner, and 0755 for the
permissions.
</p>

</body>
</section>

<section>
<title>Utilizing users and groups in packages</title>
<body>

<p>
In order to make your package install specific users and groups, specify them
as dependencies.  Accounts needed at build time must be included
in <c>DEPEND</c>, and accounts needed at runtime must be included
in <c>RDEPEND</c>.
</p>

<p>
For example, an ebuild requiring the user and group <c>foo</c> at runtime would
specify:
</p>

<pre>
RDEPEND="
    acct-user/foo
    acct-group/foo"
</pre>

<p>
This would also be sufficient if ownership of installed files were set
in <c>pkg_preinst</c>.  However, if the ebuild needs the user and group
to be present at build-time already, it would specify:
</p>

<pre>
RDEPEND="
    acct-user/foo
    acct-group/foo"
DEPEND="${RDEPEND}"
</pre>

</body>
</section>

</chapter>
</guide>
